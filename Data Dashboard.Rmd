---
title: "Forecasting food"
author: "Nickolas Tran"
date: "2023-02-22"
output: html_document
runtime: shiny
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
install.packages("tidyverse")
install.packages("xlsx")
```

```{r load data, include=FALSE}
library(readxl)
CPIForecastData <- read_excel("CPIForecast.xlsx",
                              skip = 1)
CPIHistoricalData <- read_excel("historicalcpi.xlsx", 
                                skip = 1)
```

## bar graph is trying to show changes and compares foods together

## if you want our latest work save , commit and then pull (fix conflicts if present) 

##if you want to share work save , commit , pull (fix conflicts if present) and then push


``` {r bar graph, echo=FALSE}

  library(ggplot2)

CPIForecastData_cropped <- head(CPIForecastData, 27)

# Replace non-numeric values with missing values in the "Annual 2022" and Consumer Price Index item" column

CPIForecastData_cropped$`Annual 2022` <- ifelse(grepl("[^0-9.]+", CPIForecastData_cropped$`Annual 2022`),
                                        NA,
                                        as.numeric(gsub("[^0-9.]+", "", CPIForecastData$`Annual 2022`)))

### Subset the data to remove rows with missing values in the "Annual 2022" and "Consumer Price Index item" column

CPIForecastData_complete <- CPIForecastData_cropped[complete.cases(CPIForecastData_cropped$`Annual 2022`), ]
CPIForecastData_complete <- CPIForecastData_cropped[complete.cases(CPIForecastData_cropped$`Consumer Price Index item`), ]

### Bar graph for 2022 Forecast Data

ggplot(data = CPIForecastData_complete, aes(x=`Consumer Price Index item`, y=`Annual 2022`)) +
  geom_bar(stat="identity", fill="steelblue") +
  labs(title="2022 Forecasted percent change of food prices", x="Food Item", y="Percent change") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

## Overall increase in food in general seperate year/decade etc
``` {r line graph, echo=FALSE}

library(ggplot2)
library(xlsx)

# Read the Excel file into R
CPIHistoricalData <- read.xlsx("CPIHistorical.xlsx", sheetIndex = 1)

# Plot a line graph
ggplot(CPIHistoricalData, aes(x=year, y=sales)) +
  geom_line(color="red") +
  labs(title="title", x="Year", y="Sales")
```

##Overall increase in food and we can try to highlight foods on plot

``` {r point graph, echo=FALSE}
 library(ggplot2)
ggplot(CPIHistoricalData, aes(x=x, y=y)) +
   geom_point(color="blue") +
   labs(title="title", x="X Axis", y="Y Axis")
```

``` {r point graph}

p <- ggplot(data = CPIHistoricalData,
            mapping = aes(x = 1974,
                          y = 1974))
                          
p + geom_point(data = CPIHistoricalData , mapping = aes(color = "continent",
                          fill = "continent")) +
  geom_smooth(method = "loess") +
  labs(x = "Food...", 
       y = "Price", 
       title = "Food price change over ... years",
       caption = "Source: CPIForecastData")
```

```{Interactice data}
inputPanel(
  selectInput("year_range", label = "Year range:",
              choices = unique(CPIHistoricalData$year), selected = c(min(CPIHistoricalData$year), max(CPIHistoricalData$year)), multiple = TRUE)
)

renderPlot({
  CPIHistoricalData %>%
    filter(year %in% input$year_range) %>%
    ggplot(aes(x = year, y = sales)) +
    geom_line(color = "blue") +
    labs(x = NULL, y = NULL,
        title = "Sales over time",
        subtitle = paste0("Data from ", min(CPIHistoricalData$year), " to ", max(CPIHistoricalData$year))) +
    theme_minimal()
})

renderDataTable({
  CPIHistoricalData %>%
    filter(year %in% input$year_range) %>%
    select(year, sales) %>%
    arrange(desc(year))
})

```
