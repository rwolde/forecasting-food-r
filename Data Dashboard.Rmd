---
title: "Forecasting food"
author: "Nickolas Tran"
date: "2023-02-22"
output: html_document
runtime: shiny
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load data, include=FALSE}
library(readxl)
CPIForecastData <- read_excel("CPIForecast.xlsx",
                              skip = 1)
CPIHistoricalData <- read_excel("historicalcpi.xlsx", 
                                skip = 1)
```

## bar graph is trying to show changes and compares foods together

## if you want our latest work save , commit and then pull (fix conflicts if present) 

##if you want to share work save , commit , pull (fix conflicts if present) and then push


``` {r bar graph, echo=FALSE}

  library(ggplot2)

CPIForecastData_cropped <- head(CPIForecastData, 27)

# Replace non-numeric values with missing values in the "Annual 2022" and Consumer Price Index item" column

CPIForecastData_cropped$`Annual 2022` <- ifelse(grepl("[^0-9.]+", CPIForecastData_cropped$`Annual 2022`),
                                        NA,
                                        as.numeric(gsub("[^0-9.]+", "", CPIForecastData$`Annual 2022`)))

### Subset the data to remove rows with missing values in the "Annual 2022" and "Consumer Price Index item" column

CPIForecastData_complete <- CPIForecastData_cropped[complete.cases(CPIForecastData_cropped$`Annual 2022`), ]
CPIForecastData_complete <- CPIForecastData_cropped[complete.cases(CPIForecastData_cropped$`Consumer Price Index item`), ]

### Bar graph for 2022 Forecast Data

ggplot(data = CPIForecastData_complete, aes(x=`Consumer Price Index item`, y=`Annual 2022`)) +
  geom_bar(stat="identity", fill="steelblue") +
  labs(title="2022 Forecasted percent change of food prices", x="Food Item", y="Percent change") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

## Overall increase in food in general seperate year/decade etc

##Overall increase in food and we can try to highlight foods on plot

``` {r point graph}

p <- ggplot(data = CPIHistoricalData,
            mapping = aes(x = 1974,
                          y = 1974))
                          
p + geom_point(data = CPIHistoricalData , mapping = aes(color = "continent",
                          fill = "continent")) +
  geom_smooth(method = "loess") +
  labs(x = "Food...", 
       y = "Price", 
       title = "Food price change over ... years",
       caption = "Source: CPIForecastData")
```

``` {r interactive line graph}

library(plotly)
library(readxl)
library(tidyr)
library(plotly)

# Read in CPI data
CPIHistoricalData <- read_excel("historicalcpi.xlsx", skip = 1)

# Subset the data to only include meat, eggs, and chicken
meat_eggs_pork <- CPIHistoricalData[CPIHistoricalData$`Consumer Price Index item` %in% c("Beef and veal", "Eggs", "Pork"),]

# Transform the data into long format
meat_eggs_pork <- gather(meat_eggs_pork, key = "Year", value = "Price_Index", -c(`Consumer Price Index item`))

meat_eggs_pork$Price_Index <- as.numeric(meat_eggs_pork$Price_Index)

### Adjusted data from 2000 to 2010
meat_eggs_pork <- meat_eggs_pork[meat_eggs_pork$Year >= 2000 & meat_eggs_pork$Year <= 2010,]

# Create plotly object
p <- plot_ly(data = meat_eggs_pork, x = ~Year, y = ~Price_Index, color = ~`Consumer Price Index item`, type = "scatter", mode = "lines+markers") 

# Customize layout
p <- layout(p, title = "CPI for Meat, Eggs, and Chicken", 
            xaxis = list(title = "Year"), 
            yaxis = list(title = "Price Index"))

p
```

